<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link rel="icon" href="<%= BASE_URL %>favicon.ico">
    <title>janos-vue-demo</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <style>
        body {
            max-width: 720px;
            margin: 50px auto;
        }

        #test_video {
            width: 720px;
        }

        .controls {
            display: flex;
            justify-content: space-around;
            align-items: center;
        }
        input.input, .form-inline .input-group>.form-control {
            width: 300px;
        }
        .logs {
            overflow: auto;
            width: 720px;
            height: 150px;
            padding: 5px;
            border-top: solid 1px gray;
            border-bottom: solid 1px gray;
        }
        button {
            margin: 5px
        }
    </style>

  </head>
  <body>
    <noscript>
      <strong>We're sorry but janos-vue-demo doesn't work properly without JavaScript enabled. Please enable it to continue.</strong>
    </noscript>







<video id="test_video" controls autoplay>
<!--    <source src="rtsp://184.72.239.149/vod/mp4:BigBuckBunny_175k.mov" type="application/x-rtsp"> -->
</video>
<div class="controls form">
    <div>
        Playback rate:&nbsp;
            <input id="rate" class="input" type="range" min="0.5" max="5.0" value="1.0" step="0.5">
            <output for="rate" id="rate_res">live</output>
    </div>
    <div>
        <button id="to_end" class="btn btn-success">live</button>
    </div>
</div>

  <p><br>Have any suggestions to improve our player? <br>Feel free to leave comments or ideas email: streamedian.player@gmail.com</p>
  <p>View HTML5 RTSP video player log</p>
  <div id="pllogs" class="logs"></div>
  <button class="btn btn-success" onclick="cleanLog(pllogs)">clear</button>
  <button class="btn btn-success" onclick="scrollset(pllogs, true)">scroll up</button>
  <button class="btn btn-success" onclick="scrollset(pllogs, false)">scroll down</button>
  <button id="scrollSetPl" class="btn btn-success" onclick="scrollswitch(pllogs)">Scroll off</button>
  </br></br>

<script src="https://streamedian.com/static/js/vendors/jquery-1.9.1.js"></script>
<script>
  var scrollStatPl = true;
  var scrollStatWs = true;
  var pllogs = document.getElementById("pllogs");
  var wslogs = document.getElementById("wslogs");

  var player_src = "";
  if(/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
    player_src = "rtsp://184.72.239.149/vod/mp4:BigBuckBunny_175k.mov";
  } else {
    player_src = "rtsp://camproxy.ru:8554/bars";
  }

  // if(test_video){
 //        var test_video = document.getElementById("test_video");
 //        var rtspsource = document.createElement("source");
 //        test_video.appendChild(rtspsource.src=player_src);
 //    }

    // define a new console
    var console=(function(oldConsole){
      return {
        log: function(){
        oldConsole.log(newConsole(arguments, "black", "#A9F5A9"));
        },
        info: function () {
        oldConsole.info(newConsole(arguments, "black", "#A9F5A9"));
        },
        warn: function () {
        oldConsole.warn(newConsole(arguments, "black", "#F3F781"));
        },
        error: function () {
        oldConsole.error(newConsole(arguments, "black", "#F5A9A9"));
        }
      };
    }(window.console));

    function newConsole(args, textColor, backColor){
    let text = '';
    let node = document.createElement("div");
    for (let arg in args){
        text +=' ' + args[arg];
    }
    node.appendChild(document.createTextNode(text));
    node.style.color = textColor;
    node.style.backgroundColor = backColor;
    pllogs.appendChild(node);
    autoscroll(pllogs);
    return text;
    }

    //Then redefine the old console
    window.console = console;

    function cleanLog(element){
    while (element.firstChild) {
        element.removeChild(element.firstChild);
    }
    }

    function autoscroll(element){
      if(scrollStatus(element)){
      element.scrollTop = element.scrollHeight;
    }
    if(element.childElementCount > 1000){
      element.removeChild(element.firstChild);
    }
    }

    function scrollset(element, state){
    if(state){
      element.scrollTop = 0;
      scrollChange(element, false);
    } else {
      element.scrollTop = element.scrollHeight;
      scrollChange(element, true);
    }
    }

    function scrollswitch(element){
      if(scrollStatus(element)){
        scrollChange(element, false);
      } else {
        scrollChange(element, true);
      }
    }

    function scrollChange(element, status){
    if(scrollStatus(element)){
        scrollStatPl = false;
        document.getElementById("scrollSetPl").innerText = "Scroll on";
      } else {
        scrollStatPl = true;
        document.getElementById("scrollSetPl").innerText = "Scroll off";
      }
    }

    function scrollStatus(element){
      if(element.id === "pllogs"){
        return scrollStatPl;
      } else {
        return scrollStatWs;
      }
    }


</script>

<script src="https://streamedian.com/static/js/vendors/free.player.1.8.js"></script>
<script>
    var player = document.getElementById('test_video');
    var rtspsource = document.createElement("source");
    rtspsource.src=player_src;
    player.appendChild(rtspsource);
    Streamedian.player('test_video', {socket:"wss://streamedian.com/ws/"});
    var range = document.getElementById('rate');
    var set_live = document.getElementById('to_end');
    var range_out = document.getElementById('rate_res');
    range.addEventListener('input', function () {
          player.playbackRate = range.value;
          range_out.innerHTML = `x${range.value}`;
                });
    set_live.addEventListener('click', function () {
                            range.value = 1.0;
                            range_out.innerHTML = `live`;
                            player.playbackRate = 1;
                            player.currentTime = player.buffered.end(0);//player.seekable.end(player.seekable.length - 1);
                            });
</script>







    <!-- <div id="app"></div> -->
    <!-- built files will be auto injected -->
  </body>
</html>
