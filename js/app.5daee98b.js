(function(e){function r(r){for(var t,a,s=r[0],d=r[1],c=r[2],u=0,v=[];u<s.length;u++)a=s[u],o[a]&&v.push(o[a][0]),o[a]=0;for(t in d)Object.prototype.hasOwnProperty.call(d,t)&&(e[t]=d[t]);l&&l(r);while(v.length)v.shift()();return i.push.apply(i,c||[]),n()}function n(){for(var e,r=0;r<i.length;r++){for(var n=i[r],t=!0,s=1;s<n.length;s++){var d=n[s];0!==o[d]&&(t=!1)}t&&(i.splice(r--,1),e=a(a.s=n[0]))}return e}var t={},o={app:0},i=[];function a(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=t,a.d=function(e,r,n){a.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,r){if(1&r&&(e=a(e)),8&r)return e;if(4&r&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var t in e)a.d(n,t,function(r){return e[r]}.bind(null,t));return n},a.n=function(e){var r=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(r,"a",r),r},a.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},a.p="/janus-vue-demo/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],d=s.push.bind(s);s.push=r,s=s.slice();for(var c=0;c<s.length;c++)r(s[c]);var l=d;i.push([0,"chunk-vendors"]),n()})({0:function(e,r,n){e.exports=n("56d7")},"3dfd":function(e,r,n){"use strict";n.r(r);var t=function(){var e=this,r=e.$createElement,n=e._self._c||r;return n("div",{attrs:{id:"app"}},[n("div",{staticClass:"container"},[n("div",{staticClass:"columns"},[n("div",{staticClass:"column is-half"},[n("player",{ref:"player",class:{"is-playing":e.isPlaying},attrs:{rtspSrc:e.rtspSrc}})],1)]),n("div",{staticClass:"columns"},[n("div",{staticClass:"column is-half"},[n("form",[n("b-field",[n("b-autocomplete",{staticClass:"player-url",attrs:{title:"Для ввода адреса, остановите воспроизведение",data:e.serverList,placeholder:"rtsp://...","icon-pack":"fas",icon:"video"},on:{select:function(r){return e.selected=r}},nativeOn:{keyup:function(r){if(!r.type.indexOf("key")&&e._k(r.keyCode,"enter",13,r.key,"Enter"))return null;e.isPlaying?e.$refs.player.stopStream():e.$refs.player.startStream()}},model:{value:e.rtspSrc,callback:function(r){e.rtspSrc=r},expression:"rtspSrc"}}),n("p",{staticClass:"control"},[e.$refs.player?n("b-button",{attrs:{"icon-pack":"fas","icon-right":e.isPlaying?"stop":"play",type:e.isPlaying?"is-dark":"is-success"},on:{click:function(r){e.isPlaying?e.$refs.player.stopStream():e.$refs.player.startStream()}}}):e._e()],1)],1)],1)])]),e.$route.query.debug?n("div",{staticClass:"columns"},[n("div",{ref:"consolePanel",staticClass:"column logs-panel"},[n("b-tabs",{attrs:{expanded:""},model:{value:e.logTabsActive,callback:function(r){e.logTabsActive=r},expression:"logTabsActive"}},e._l(["debug","error","info"],function(r){return n("b-tab-item",{key:r,attrs:{label:r}},[n("div",{staticClass:"logs-panel-scroll",class:r},[e._l(e.console[r],function(r,t){return[n("p",{key:t,staticClass:"log-item",class:r.type},[n("b-tag",{attrs:{type:"is-"+e.logsTypeClasses[r.type]},on:{close:function(r){e.isTag2Active=!1}}},[e._v("\n                        "+e._s(r.type)+"\n                    ")]),e._v("\n                    "+e._s(r.message)+"\n                  ")],1)]})],2)])}),1)],1)]):e._e()])])},o=[],i=function(){var e=this,r=e.$createElement,n=e._self._c||r;return n("div",{staticClass:"player",style:e.videoStyle},[n("video",{ref:"rtspPlayer",staticClass:"has-text-centered",attrs:{width:"100%",id:"rtsp_player",height:"auto",autoplay:""}})])},a=[],s=(n("a481"),n("aef6"),n("28a5"),n("7f7f"),n("7514"),n("7618")),d=(n("ac6a"),n("5df3"),n("4917"),n("9a68")),c=n.n(d);u.sessions={},u.isExtensionEnabled=function(){if(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)return!0;if(window.navigator.userAgent.match("Chrome")){var e=parseInt(window.navigator.userAgent.match(/Chrome\/(.*) /)[1],10),r=33;return window.navigator.userAgent.match("Linux")&&(r=35),e>=26&&e<=r||u.extension.isInstalled()}return!0};var l={extensionId:"hapfgfdkleiggjjpfpenajgdnfckjpaj",isInstalled:function(){return null!==document.querySelector("#janus-extension-installed")},getScreen:function(e){var r=window.setTimeout(function(){var r=new Error("NavigatorUserMediaError");return r.name='The required Chrome extension is not installed: click <a href="#">here</a> to install it. (NOTE: this will need you to refresh the page)',e(r)},1e3);this.cache[r]=e,window.postMessage({type:"janusGetScreen",id:r},"*")},init:function(){var e={};this.cache=e,window.addEventListener("message",function(r){if(r.origin==window.location.origin)if("janusGotScreen"==r.data.type&&e[r.data.id]){var n=e[r.data.id];if(delete e[r.data.id],""===r.data.sourceId){var t=new Error("NavigatorUserMediaError");t.name="You cancelled the request for permission, giving up...",n(t)}else n(null,r.data.sourceId)}else"janusGetScreenPending"==r.data.type&&(console.log("clearing ",r.data.id),window.clearTimeout(r.data.id))})}};function u(e){if(void 0===u.initDone)return e.error("Library not initialized"),{};if(!u.isWebrtcSupported())return e.error("WebRTC not supported by this browser"),{};if(u.log("Library initialized: "+u.initDone),e=e||{},e.success="function"==typeof e.success?e.success:u.noop,e.error="function"==typeof e.error?e.error:u.noop,e.destroyed="function"==typeof e.destroyed?e.destroyed:u.noop,null===e.server||void 0===e.server)return e.error("Invalid server url"),{};var r=!1,n=null,t={},o=null,i=null,a=0,d=e.server;u.isArray(d)?(u.log("Multiple servers provided ("+d.length+"), will use the first that works"),d=null,i=e.server,u.debug(i)):0===d.indexOf("ws")?(r=!0,u.log("Using WebSockets to contact Janus: "+d)):(r=!1,u.log("Using REST API to contact Janus: "+d));var c=e.iceServers;void 0!==c&&null!==c||(c=[{urls:"stun:stun.l.google.com:19302"}]);var l=e.iceTransportPolicy,v=e.bundlePolicy,f=e.ipv6;void 0!==f&&null!==f||(f=!1);var g=!1;void 0!==e.withCredentials&&null!==e.withCredentials&&(g=!0===e.withCredentials);var p=10;void 0!==e.max_poll_events&&null!==e.max_poll_events&&(p=e.max_poll_events),p<1&&(p=1);var m=null;void 0!==e.token&&null!==e.token&&(m=e.token);var b=null;void 0!==e.apisecret&&null!==e.apisecret&&(b=e.apisecret),this.destroyOnUnload=!0,void 0!==e.destroyOnUnload&&null!==e.destroyOnUnload&&(this.destroyOnUnload=!0===e.destroyOnUnload);var h=25e3;void 0!==e.keepAlivePeriod&&null!==e.keepAlivePeriod&&(h=e.keepAlivePeriod),isNaN(h)&&(h=25e3);var S=6e4;void 0!==e.longPollTimeout&&null!==e.longPollTimeout&&(S=e.longPollTimeout),isNaN(S)&&(S=6e4);var y=!1,w=null,k={},T=this,C=0,A={};function D(){if(null!=w)if(u.debug("Long poll..."),y){var r=d+"/"+w+"?rid="+(new Date).getTime();void 0!==p&&null!==p&&(r=r+"&maxev="+p),null!==m&&void 0!==m&&(r=r+"&token="+encodeURIComponent(m)),null!==b&&void 0!==b&&(r=r+"&apisecret="+encodeURIComponent(b)),u.httpAPICall(r,{verb:"GET",withCredentials:g,success:R,timeout:S,error:function(r,n){if(u.error(r+":",n),C++,C>3)return y=!1,void e.error("Lost connection to the server (is it down?)");D()}})}else u.warn("Is the server down? (connected=false)")}function R(e,t){if(C=0,r||void 0===w||null===w||!0===t||D(),r||!u.isArray(e))if("keepalive"!==e["janus"])if("ack"!==e["janus"])if("success"!==e["janus"])if("trickle"===e["janus"]){var o=e["sender"];if(void 0===o||null===o)return void u.warn("Missing sender...");var i=k[o];if(void 0===i||null===i)return void u.debug("This handle is not attached to this session");var a=e["candidate"];u.debug("Got a trickled candidate on session "+w),u.debug(a);var s=i.webrtcStuff;s.pc&&s.remoteSdp?(u.debug("Adding remote candidate:",a),a&&!0!==a.completed?s.pc.addIceCandidate(a):s.pc.addIceCandidate(u.endOfCandidates)):(u.debug("We didn't do setRemoteDescription (trickle got here before the offer?), caching candidate"),s.candidates||(s.candidates=[]),s.candidates.push(a),u.debug(s.candidates))}else{if("webrtcup"===e["janus"]){u.debug("Got a webrtcup event on session "+w),u.debug(e);o=e["sender"];if(void 0===o||null===o)return void u.warn("Missing sender...");i=k[o];return void 0===i||null===i?void u.debug("This handle is not attached to this session"):void i.webrtcState(!0)}if("hangup"===e["janus"]){u.debug("Got a hangup event on session "+w),u.debug(e);o=e["sender"];if(void 0===o||null===o)return void u.warn("Missing sender...");i=k[o];if(void 0===i||null===i)return void u.debug("This handle is not attached to this session");i.webrtcState(!1,e["reason"]),i.hangup()}else if("detached"===e["janus"]){u.debug("Got a detached event on session "+w),u.debug(e);o=e["sender"];if(void 0===o||null===o)return void u.warn("Missing sender...");i=k[o];if(void 0===i||null===i)return;i.detached=!0,i.ondetached(),i.detach()}else if("media"===e["janus"]){u.debug("Got a media event on session "+w),u.debug(e);o=e["sender"];if(void 0===o||null===o)return void u.warn("Missing sender...");i=k[o];if(void 0===i||null===i)return void u.debug("This handle is not attached to this session");i.mediaState(e["type"],e["receiving"])}else if("slowlink"===e["janus"]){u.debug("Got a slowlink event on session "+w),u.debug(e);o=e["sender"];if(void 0===o||null===o)return void u.warn("Missing sender...");i=k[o];if(void 0===i||null===i)return void u.debug("This handle is not attached to this session");i.slowLink(e["uplink"],e["lost"])}else{if("error"===e["janus"]){u.error("Ooops: "+e["error"].code+" "+e["error"].reason),u.debug(e);f=e["transaction"];if(null!==f&&void 0!==f){g=A[f];null!==g&&void 0!==g&&g(e),delete A[f]}return}if("event"===e["janus"]){u.debug("Got a plugin event on session "+w),u.debug(e);o=e["sender"];if(void 0===o||null===o)return void u.warn("Missing sender...");var d=e["plugindata"];if(void 0===d||null===d)return void u.warn("Missing plugindata...");u.debug("  -- Event is coming from "+o+" ("+d["plugin"]+")");var c=d["data"];u.debug(c);i=k[o];if(void 0===i||null===i)return void u.warn("This handle is not attached to this session");var l=e["jsep"];void 0!==l&&null!==l&&(u.debug("Handling SDP as well..."),u.debug(l));var v=i.onmessage;null!==v&&void 0!==v?(u.debug("Notifying application..."),v(c,l)):u.debug("No provided notification callback")}else{if("timeout"===e["janus"])return u.error("Timeout on session "+w),u.debug(e),void(r&&n.close(3504,"Gateway timeout"));u.warn("Unknown message/event  '"+e["janus"]+"' on session "+w),u.debug(e)}}}else{u.debug("Got a success on session "+w),u.debug(e);var f=e["transaction"];if(null!==f&&void 0!==f){var g=A[f];null!==g&&void 0!==g&&g(e),delete A[f]}}else{u.debug("Got an ack on session "+w),u.debug(e);var f=e["transaction"];if(null!==f&&void 0!==f){var g=A[f];null!==g&&void 0!==g&&g(e),delete A[f]}}else u.vdebug("Got a keepalive on session "+w);else for(var p=0;p<e.length;p++)R(e[p],!0)}function P(){if(null!==d&&r&&y){o=setTimeout(P,h);var e={janus:"keepalive",session_id:w,transaction:u.randomString(12)};null!==m&&void 0!==m&&(e["token"]=m),null!==b&&void 0!==b&&(e["apisecret"]=b),n.send(JSON.stringify(e))}}function I(s){var c=u.randomString(12),l={janus:"create",transaction:c};if(s["reconnect"]&&(y=!1,l["janus"]="claim",l["session_id"]=w,n&&(n.onopen=null,n.onerror=null,n.onclose=null,o&&(clearTimeout(o),o=null))),null!==m&&void 0!==m&&(l["token"]=m),null!==b&&void 0!==b&&(l["apisecret"]=b),null===d&&u.isArray(i)&&(d=i[a],0===d.indexOf("ws")?(r=!0,u.log("Server #"+(a+1)+": trying WebSockets to contact Janus ("+d+")")):(r=!1,u.log("Server #"+(a+1)+": trying REST API to contact Janus ("+d+")"))),r)for(var v in n=u.newWebSocket(d,"janus-protocol"),t={error:function(){if(u.error("Error connecting to the Janus WebSockets server... "+d),u.isArray(i)&&!s["reconnect"])return a++,a==i.length?void s.error("Error connecting to any of the provided Janus servers: Is the server down?"):(d=null,void setTimeout(function(){I(s)},200));s.error("Error connecting to the Janus WebSockets server: Is the server down?")},open:function(){A[c]=function(e){if(u.debug(e),"success"!==e["janus"])return u.error("Ooops: "+e["error"].code+" "+e["error"].reason),void s.error(e["error"].reason);o=setTimeout(P,h),y=!0,w=e["session_id"]?e["session_id"]:e.data["id"],s["reconnect"]?u.log("Claimed session: "+w):u.log("Created session: "+w),u.sessions[w]=T,s.success()},n.send(JSON.stringify(l))},message:function(e){R(JSON.parse(e.data))},close:function(){null!==d&&y&&(y=!1,e.error("Lost connection to the server (is it down?)"))}},t)n.addEventListener(v,t[v]);else u.httpAPICall(d,{verb:"POST",withCredentials:g,body:l,success:function(e){if(u.debug(e),"success"!==e["janus"])return u.error("Ooops: "+e["error"].code+" "+e["error"].reason),void s.error(e["error"].reason);y=!0,w=e["session_id"]?e["session_id"]:e.data["id"],s["reconnect"]?u.log("Claimed session: "+w):u.log("Created session: "+w),u.sessions[w]=T,D(),s.success()},error:function(e,r){if(u.error(e+":",r),u.isArray(i)&&!s["reconnect"])return a++,a==i.length?void s.error("Error connecting to any of the provided Janus servers: Is the server down?"):(d=null,void setTimeout(function(){I(s)},200));""===r?s.error(e+": Is the server down?"):s.error(e+": "+r)}})}function O(i){i=i||{},i.success="function"==typeof i.success?i.success:u.noop;var a=!0;void 0!==i.asyncRequest&&null!==i.asyncRequest&&(a=!0===i.asyncRequest);var s=!0;void 0!==i.notifyDestroyed&&null!==i.notifyDestroyed&&(s=!0===i.notifyDestroyed);var c=!1;if(void 0!==i.cleanupHandles&&null!==i.cleanupHandles&&(c=!0===i.cleanupHandles),u.log("Destroying session "+w+" (async="+a+")"),!y)return u.warn("Is the server down? (connected=false)"),void i.success();if(void 0===w||null===w)return u.warn("No session to destroy"),i.success(),void(s&&e.destroyed());if(c)for(var l in k)_(l,{noRequest:!0});var v={janus:"destroy",transaction:u.randomString(12)};if(null!==m&&void 0!==m&&(v["token"]=m),null!==b&&void 0!==b&&(v["apisecret"]=b),r){v["session_id"]=w;var f=function(){for(var e in t)n.removeEventListener(e,t[e]);n.removeEventListener("message",p),n.removeEventListener("error",h),o&&clearTimeout(o),n.close()},p=function(r){var n=JSON.parse(r.data);n.session_id==v.session_id&&n.transaction==v.transaction&&(f(),i.success(),s&&e.destroyed())},h=function(r){f(),i.error("Failed to destroy the server: Is the server down?"),s&&e.destroyed()};return n.addEventListener("message",p),n.addEventListener("error",h),void n.send(JSON.stringify(v))}u.httpAPICall(d+"/"+w,{verb:"POST",async:a,withCredentials:g,body:v,success:function(r){u.log("Destroyed session:"),u.debug(r),w=null,y=!1,"success"!==r["janus"]&&u.error("Ooops: "+r["error"].code+" "+r["error"].reason),i.success(),s&&e.destroyed()},error:function(r,n){u.error(r+":",n),w=null,y=!1,i.success(),s&&e.destroyed()}})}function V(e){if(e=e||{},e.success="function"==typeof e.success?e.success:u.noop,e.error="function"==typeof e.error?e.error:u.noop,e.consentDialog="function"==typeof e.consentDialog?e.consentDialog:u.noop,e.iceState="function"==typeof e.iceState?e.iceState:u.noop,e.mediaState="function"==typeof e.mediaState?e.mediaState:u.noop,e.webrtcState="function"==typeof e.webrtcState?e.webrtcState:u.noop,e.slowLink="function"==typeof e.slowLink?e.slowLink:u.noop,e.onmessage="function"==typeof e.onmessage?e.onmessage:u.noop,e.onlocalstream="function"==typeof e.onlocalstream?e.onlocalstream:u.noop,e.onremotestream="function"==typeof e.onremotestream?e.onremotestream:u.noop,e.ondata="function"==typeof e.ondata?e.ondata:u.noop,e.ondataopen="function"==typeof e.ondataopen?e.ondataopen:u.noop,e.oncleanup="function"==typeof e.oncleanup?e.oncleanup:u.noop,e.ondetached="function"==typeof e.ondetached?e.ondetached:u.noop,!y)return u.warn("Is the server down? (connected=false)"),void e.error("Is the server down? (connected=false)");var t=e.plugin;if(void 0===t||null===t)return u.error("Invalid plugin"),void e.error("Invalid plugin");var o=e.opaqueId,i=e.token?e.token:m,a=u.randomString(12),s={janus:"attach",plugin:t,opaque_id:o,transaction:a};if(null!==i&&void 0!==i&&(s["token"]=i),null!==b&&void 0!==b&&(s["apisecret"]=b),r)return A[a]=function(r){if(u.debug(r),"success"!==r["janus"])return u.error("Ooops: "+r["error"].code+" "+r["error"].reason),void e.error("Ooops: "+r["error"].code+" "+r["error"].reason);var n=r.data["id"];u.log("Created handle: "+n);var o={session:T,plugin:t,id:n,token:i,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return n},getPlugin:function(){return t},getVolume:function(){return W(n,!0)},getRemoteVolume:function(){return W(n,!0)},getLocalVolume:function(){return W(n,!1)},isAudioMuted:function(){return $(n,!1)},muteAudio:function(){return B(n,!1,!0)},unmuteAudio:function(){return B(n,!1,!1)},isVideoMuted:function(){return $(n,!0)},muteVideo:function(){return B(n,!0,!0)},unmuteVideo:function(){return B(n,!0,!1)},getBitrate:function(){return z(n)},send:function(e){j(n,e)},data:function(e){M(n,e)},dtmf:function(e){L(n,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){U(n,!0,e)},createAnswer:function(e){U(n,!1,e)},handleRemoteJsep:function(e){F(n,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){Y(n,!0===e)},detach:function(e){_(n,e)}};k[n]=o,e.success(o)},s["session_id"]=w,void n.send(JSON.stringify(s));u.httpAPICall(d+"/"+w,{verb:"POST",withCredentials:g,body:s,success:function(r){if(u.debug(r),"success"!==r["janus"])return u.error("Ooops: "+r["error"].code+" "+r["error"].reason),void e.error("Ooops: "+r["error"].code+" "+r["error"].reason);var n=r.data["id"];u.log("Created handle: "+n);var o={session:T,plugin:t,id:n,token:i,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return n},getPlugin:function(){return t},getVolume:function(){return W(n,!0)},getRemoteVolume:function(){return W(n,!0)},getLocalVolume:function(){return W(n,!1)},isAudioMuted:function(){return $(n,!1)},muteAudio:function(){return B(n,!1,!0)},unmuteAudio:function(){return B(n,!1,!1)},isVideoMuted:function(){return $(n,!0)},muteVideo:function(){return B(n,!0,!0)},unmuteVideo:function(){return B(n,!0,!1)},getBitrate:function(){return z(n)},send:function(e){j(n,e)},data:function(e){M(n,e)},dtmf:function(e){L(n,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){U(n,!0,e)},createAnswer:function(e){U(n,!1,e)},handleRemoteJsep:function(e){F(n,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){Y(n,!0===e)},detach:function(e){_(n,e)}};k[n]=o,e.success(o)},error:function(e,r){u.error(e+":",r)}})}function j(e,t){if(t=t||{},t.success="function"==typeof t.success?t.success:u.noop,t.error="function"==typeof t.error?t.error:u.noop,!y)return u.warn("Is the server down? (connected=false)"),void t.error("Is the server down? (connected=false)");var o=k[e];if(null===o||void 0===o||null===o.webrtcStuff||void 0===o.webrtcStuff)return u.warn("Invalid handle"),void t.error("Invalid handle");var i=t.message,a=t.jsep,s=u.randomString(12),c={janus:"message",body:i,transaction:s};if(null!==o.token&&void 0!==o.token&&(c["token"]=o.token),null!==b&&void 0!==b&&(c["apisecret"]=b),null!==a&&void 0!==a&&(c.jsep=a),u.debug("Sending message to plugin (handle="+e+"):"),u.debug(c),r)return c["session_id"]=w,c["handle_id"]=e,A[s]=function(e){if(u.debug("Message sent!"),u.debug(e),"success"===e["janus"]){var r=e["plugindata"];if(void 0===r||null===r)return u.warn("Request succeeded, but missing plugindata..."),void t.success();u.log("Synchronous transaction successful ("+r["plugin"]+")");var n=r["data"];return u.debug(n),void t.success(n)}"ack"===e["janus"]?t.success():void 0!==e["error"]&&null!==e["error"]?(u.error("Ooops: "+e["error"].code+" "+e["error"].reason),t.error(e["error"].code+" "+e["error"].reason)):(u.error("Unknown error"),t.error("Unknown error"))},void n.send(JSON.stringify(c));u.httpAPICall(d+"/"+w+"/"+e,{verb:"POST",withCredentials:g,body:c,success:function(e){if(u.debug("Message sent!"),u.debug(e),"success"===e["janus"]){var r=e["plugindata"];if(void 0===r||null===r)return u.warn("Request succeeded, but missing plugindata..."),void t.success();u.log("Synchronous transaction successful ("+r["plugin"]+")");var n=r["data"];return u.debug(n),void t.success(n)}"ack"===e["janus"]?t.success():void 0!==e["error"]&&null!==e["error"]?(u.error("Ooops: "+e["error"].code+" "+e["error"].reason),t.error(e["error"].code+" "+e["error"].reason)):(u.error("Unknown error"),t.error("Unknown error"))},error:function(e,r){u.error(e+":",r),t.error(e+": "+r)}})}function x(e,t){if(y){var o=k[e];if(null!==o&&void 0!==o&&null!==o.webrtcStuff&&void 0!==o.webrtcStuff){var i={janus:"trickle",candidate:t,transaction:u.randomString(12)};if(null!==o.token&&void 0!==o.token&&(i["token"]=o.token),null!==b&&void 0!==b&&(i["apisecret"]=b),u.vdebug("Sending trickle candidate (handle="+e+"):"),u.vdebug(i),r)return i["session_id"]=w,i["handle_id"]=e,void n.send(JSON.stringify(i));u.httpAPICall(d+"/"+w+"/"+e,{verb:"POST",withCredentials:g,body:i,success:function(e){u.vdebug("Candidate sent!"),u.vdebug(e),"ack"===e["janus"]||u.error("Ooops: "+e["error"].code+" "+e["error"].reason)},error:function(e,r){u.error(e+":",r)}})}else u.warn("Invalid handle")}else u.warn("Is the server down? (connected=false)")}function E(e,r,n,t){var o=k[e];if(null!==o&&void 0!==o&&null!==o.webrtcStuff&&void 0!==o.webrtcStuff){var i=o.webrtcStuff,a=function(e){u.log("Received message on data channel:",e);var r=e.target.label;o.ondata(e.data,r)},s=function(e){u.log("Received state change on data channel:",e);var r=e.target.label,n=i.dataChannel[r]?i.dataChannel[r].readyState:"null";if(u.log("State change on <"+r+"> data channel: "+n),"open"===n){if(i.dataChannel[r].pending&&i.dataChannel[r].pending.length>0){for(var t in u.log("Sending pending messages on <"+r+">:",i.dataChannel[r].pending.length),i.dataChannel[r].pending){var a=i.dataChannel[r].pending[t];u.log("Sending string on data channel <"+r+">: "+a),i.dataChannel[r].send(a)}i.dataChannel[r].pending=[]}o.ondataopen(r)}},d=function(e){u.error("Got error on data channel:",e)};i.dataChannel[r]=n||i.pc.createDataChannel(r,{ordered:!1}),i.dataChannel[r].onmessage=a,i.dataChannel[r].onopen=s,i.dataChannel[r].onclose=s,i.dataChannel[r].onerror=d,i.dataChannel[r].pending=[],t&&i.dataChannel[r].pending.push(t)}else u.warn("Invalid handle")}function M(e,r){r=r||{},r.success="function"==typeof r.success?r.success:u.noop,r.error="function"==typeof r.error?r.error:u.noop;var n=k[e];if(null===n||void 0===n||null===n.webrtcStuff||void 0===n.webrtcStuff)return u.warn("Invalid handle"),void r.error("Invalid handle");var t=n.webrtcStuff,o=r.text;if(null===o||void 0===o)return u.warn("Invalid text"),void r.error("Invalid text");var i=r.label?r.label:u.dataChanDefaultLabel;return t.dataChannel[i]?"open"!==t.dataChannel[i].readyState?(t.dataChannel[i].pending.push(o),void r.success()):(u.log("Sending string on data channel <"+i+">: "+o),t.dataChannel[i].send(o),void r.success()):(E(e,i,!1,o),void r.success())}function L(e,r){r=r||{},r.success="function"==typeof r.success?r.success:u.noop,r.error="function"==typeof r.error?r.error:u.noop;var n=k[e];if(null===n||void 0===n||null===n.webrtcStuff||void 0===n.webrtcStuff)return u.warn("Invalid handle"),void r.error("Invalid handle");var t=n.webrtcStuff;if(null===t.dtmfSender||void 0===t.dtmfSender){if(void 0!==t.pc&&null!==t.pc){var o=t.pc.getSenders(),i=o.find(function(e){return e.track&&"audio"===e.track.kind});if(!i)return u.warn("Invalid DTMF configuration (no audio track)"),void r.error("Invalid DTMF configuration (no audio track)");t.dtmfSender=i.dtmf,t.dtmfSender&&(u.log("Created DTMF Sender"),t.dtmfSender.ontonechange=function(e){u.debug("Sent DTMF tone: "+e.tone)})}if(null===t.dtmfSender||void 0===t.dtmfSender)return u.warn("Invalid DTMF configuration"),void r.error("Invalid DTMF configuration")}var a=r.dtmf;if(null===a||void 0===a)return u.warn("Invalid DTMF parameters"),void r.error("Invalid DTMF parameters");var s=a.tones;if(null===s||void 0===s)return u.warn("Invalid DTMF string"),void r.error("Invalid DTMF string");var d=a.duration;null!==d&&void 0!==d||(d=500);var c=a.gap;null!==c&&void 0!==c||(c=50),u.debug("Sending DTMF string "+s+" (duration "+d+"ms, gap "+c+"ms)"),t.dtmfSender.insertDTMF(s,d,c),r.success()}function _(e,t){t=t||{},t.success="function"==typeof t.success?t.success:u.noop,t.error="function"==typeof t.error?t.error:u.noop;var o=!0;void 0!==t.asyncRequest&&null!==t.asyncRequest&&(o=!0===t.asyncRequest);var i=!0;void 0!==t.noRequest&&null!==t.noRequest&&(i=!0===t.noRequest),u.log("Destroying handle "+e+" (async="+o+")"),Y(e);var a=k[e];if(null===a||void 0===a||a.detached)return delete k[e],void t.success();if(i)return delete k[e],void t.success();if(!y)return u.warn("Is the server down? (connected=false)"),void t.error("Is the server down? (connected=false)");var s={janus:"detach",transaction:u.randomString(12)};if(null!==a.token&&void 0!==a.token&&(s["token"]=a.token),null!==b&&void 0!==b&&(s["apisecret"]=b),r)return s["session_id"]=w,s["handle_id"]=e,n.send(JSON.stringify(s)),delete k[e],void t.success();u.httpAPICall(d+"/"+w+"/"+e,{verb:"POST",async:o,withCredentials:g,body:s,success:function(r){u.log("Destroyed handle:"),u.debug(r),"success"!==r["janus"]&&u.error("Ooops: "+r["error"].code+" "+r["error"].reason),delete k[e],t.success()},error:function(r,n){u.error(r+":",n),delete k[e],t.success()}})}function N(e,r,n,t,o){var i=k[e];if(null===i||void 0===i||null===i.webrtcStuff||void 0===i.webrtcStuff)return u.warn("Invalid handle"),void t.error("Invalid handle");var a=i.webrtcStuff;u.debug("streamsDone:",o),o&&(u.debug("  -- Audio tracks:",o.getAudioTracks()),u.debug("  -- Video tracks:",o.getVideoTracks()));var d=!1;if(a.myStream&&n.update&&!a.streamExternal){if((!n.update&&K(n)||n.update&&(n.addAudio||n.replaceAudio))&&o.getAudioTracks()&&o.getAudioTracks().length)if(a.myStream.addTrack(o.getAudioTracks()[0]),u.unifiedPlan){u.log((n.replaceAudio?"Replacing":"Adding")+" audio track:",o.getAudioTracks()[0]);var g=null,p=a.pc.getTransceivers();if(p&&p.length>0)for(var m in p){var b=p[m];if(b.sender&&b.sender.track&&"audio"===b.sender.track.kind||b.receiver&&b.receiver.track&&"audio"===b.receiver.track.kind){g=b;break}}g&&g.sender?g.sender.replaceTrack(o.getAudioTracks()[0]):a.pc.addTrack(o.getAudioTracks()[0],o)}else u.log((n.replaceAudio?"Replacing":"Adding")+" audio track:",o.getAudioTracks()[0]),a.pc.addTrack(o.getAudioTracks()[0],o);if((!n.update&&ee(n)||n.update&&(n.addVideo||n.replaceVideo))&&o.getVideoTracks()&&o.getVideoTracks().length)if(a.myStream.addTrack(o.getVideoTracks()[0]),u.unifiedPlan){u.log((n.replaceVideo?"Replacing":"Adding")+" video track:",o.getVideoTracks()[0]);var h=null;p=a.pc.getTransceivers();if(p&&p.length>0)for(var m in p){b=p[m];if(b.sender&&b.sender.track&&"video"===b.sender.track.kind||b.receiver&&b.receiver.track&&"video"===b.receiver.track.kind){h=b;break}}h&&h.sender?h.sender.replaceTrack(o.getVideoTracks()[0]):a.pc.addTrack(o.getVideoTracks()[0],o)}else u.log((n.replaceVideo?"Replacing":"Adding")+" video track:",o.getVideoTracks()[0]),a.pc.addTrack(o.getVideoTracks()[0],o)}else a.myStream=o,d=!0;if(!a.pc){var S={iceServers:c,iceTransportPolicy:l,bundlePolicy:v};"chrome"===u.webRTCAdapter.browserDetails.browser&&(S["sdpSemantics"]=u.webRTCAdapter.browserDetails.version<72?"plan-b":"unified-plan");var y={optional:[{DtlsSrtpKeyAgreement:!0}]};if(!0===f&&y.optional.push({googIPv6:!0}),t.rtcConstraints&&"object"===Object(s["a"])(t.rtcConstraints))for(var m in u.debug("Adding custom PeerConnection constraints:",t.rtcConstraints),t.rtcConstraints)y.optional.push(t.rtcConstraints[m]);"edge"===u.webRTCAdapter.browserDetails.browser&&(S.bundlePolicy="max-bundle"),u.log("Creating PeerConnection"),u.debug(y),a.pc=new RTCPeerConnection(S,y),u.debug(a.pc),a.pc.getStats&&(a.volume={},a.bitrate.value="0 kbits/sec"),u.log("Preparing local SDP and gathering candidates (trickle="+a.trickle+")"),a.pc.oniceconnectionstatechange=function(e){a.pc&&i.iceState(a.pc.iceConnectionState)},a.pc.onicecandidate=function(r){if(null==r.candidate||"edge"===u.webRTCAdapter.browserDetails.browser&&r.candidate.candidate.indexOf("endOfCandidates")>0)u.log("End of candidates."),a.iceDone=!0,!0===a.trickle?x(e,{completed:!0}):G(e,t);else{var n={candidate:r.candidate.candidate,sdpMid:r.candidate.sdpMid,sdpMLineIndex:r.candidate.sdpMLineIndex};!0===a.trickle&&x(e,n)}},a.pc.ontrack=function(e){u.log("Handling Remote Track"),u.debug(e),e.streams&&(a.remoteStream=e.streams[0],i.onremotestream(a.remoteStream),e.track.onended||(u.log("Adding onended callback to track:",e.track),e.track.onended=function(e){u.log("Remote track muted/removed:",e),a.remoteStream&&(a.remoteStream.removeTrack(e.target),i.onremotestream(a.remoteStream))},e.track.onmute=e.track.onended,e.track.onunmute=function(e){u.log("Remote track flowing again:",e);try{a.remoteStream.addTrack(e.target),i.onremotestream(a.remoteStream)}catch(r){u.error(r)}}))}}if(d&&null!==o&&void 0!==o){u.log("Adding local stream");var w=!0===t.simulcast2;o.getTracks().forEach(function(e){u.log("Adding local track:",e),w?"audio"===e.kind?a.pc.addTrack(e,o):(u.log("Enabling rid-based simulcasting:",e),a.pc.addTransceiver(e,{direction:"sendrecv",streams:[o],sendEncodings:[{rid:"h",active:!0,maxBitrate:9e5},{rid:"m",active:!0,maxBitrate:3e5,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:1e5,scaleResolutionDownBy:4}]})):a.pc.addTrack(e,o)})}oe(n)&&!a.dataChannel[u.dataChanDefaultLabel]&&(u.log("Creating data channel"),E(e,u.dataChanDefaultLabel,!1),a.pc.ondatachannel=function(r){u.log("Data channel created by Janus:",r),E(e,r.channel.label,r.channel)}),a.myStream&&i.onlocalstream(a.myStream),null===r||void 0===r?J(e,n,t):a.pc.setRemoteDescription(r).then(function(){if(u.log("Remote description accepted!"),a.remoteSdp=r.sdp,a.candidates&&a.candidates.length>0){for(var o in a.candidates){var i=a.candidates[o];u.debug("Adding remote candidate:",i),i&&!0!==i.completed?a.pc.addIceCandidate(i):a.pc.addIceCandidate(u.endOfCandidates)}a.candidates=[]}q(e,n,t)},t.error)}function U(e,r,n){n=n||{},n.success="function"==typeof n.success?n.success:u.noop,n.error="function"==typeof n.error?n.error:H;var t=n.jsep;if(r&&t)return u.error("Provided a JSEP to a createOffer"),void n.error("Provided a JSEP to a createOffer");if(!r&&(!t||!t.type||!t.sdp))return u.error("A valid JSEP is required for createAnswer"),void n.error("A valid JSEP is required for createAnswer");n.media=n.media||{audio:!0,video:!0};var o=n.media,i=k[e];if(null===i||void 0===i||null===i.webrtcStuff||void 0===i.webrtcStuff)return u.warn("Invalid handle"),void n.error("Invalid handle");var a=i.webrtcStuff;if(a.trickle=ie(n.trickle),void 0===a.pc||null===a.pc)o.update=!1,o.keepAudio=!1,o.keepVideo=!1;else if(void 0!==a.pc&&null!==a.pc){if(u.log("Updating existing media session"),o.update=!0,null!==n.stream&&void 0!==n.stream)n.stream!==a.myStream&&u.log("Renegotiation involves a new external stream");else{if(o.addAudio){if(o.keepAudio=!1,o.replaceAudio=!1,o.removeAudio=!1,o.audioSend=!0,a.myStream&&a.myStream.getAudioTracks()&&a.myStream.getAudioTracks().length)return u.error("Can't add audio stream, there already is one"),void n.error("Can't add audio stream, there already is one")}else o.removeAudio?(o.keepAudio=!1,o.replaceAudio=!1,o.addAudio=!1,o.audioSend=!1):o.replaceAudio&&(o.keepAudio=!1,o.addAudio=!1,o.removeAudio=!1,o.audioSend=!0);if(null===a.myStream||void 0===a.myStream?(o.replaceAudio&&(o.keepAudio=!1,o.replaceAudio=!1,o.addAudio=!0,o.audioSend=!0),K(o)&&(o.keepAudio=!1,o.addAudio=!0)):null===a.myStream.getAudioTracks()||void 0===a.myStream.getAudioTracks()||0===a.myStream.getAudioTracks().length?(o.replaceAudio&&(o.keepAudio=!1,o.replaceAudio=!1,o.addAudio=!0,o.audioSend=!0),K(o)&&(o.keepVideo=!1,o.addAudio=!0)):!K(o)||o.removeAudio||o.replaceAudio||(o.keepAudio=!0),o.addVideo){if(o.keepVideo=!1,o.replaceVideo=!1,o.removeVideo=!1,o.videoSend=!0,a.myStream&&a.myStream.getVideoTracks()&&a.myStream.getVideoTracks().length)return u.error("Can't add video stream, there already is one"),void n.error("Can't add video stream, there already is one")}else o.removeVideo?(o.keepVideo=!1,o.replaceVideo=!1,o.addVideo=!1,o.videoSend=!1):o.replaceVideo&&(o.keepVideo=!1,o.addVideo=!1,o.removeVideo=!1,o.videoSend=!0);null===a.myStream||void 0===a.myStream?(o.replaceVideo&&(o.keepVideo=!1,o.replaceVideo=!1,o.addVideo=!0,o.videoSend=!0),ee(o)&&(o.keepVideo=!1,o.addVideo=!0)):null===a.myStream.getVideoTracks()||void 0===a.myStream.getVideoTracks()||0===a.myStream.getVideoTracks().length?(o.replaceVideo&&(o.keepVideo=!1,o.replaceVideo=!1,o.addVideo=!0,o.videoSend=!0),ee(o)&&(o.keepVideo=!1,o.addVideo=!0)):!ee(o)||o.removeVideo||o.replaceVideo||(o.keepVideo=!0),o.addData&&(o.data=!0)}if(K(o)&&o.keepAudio&&ee(o)&&o.keepVideo)return i.consentDialog(!1),void N(e,t,o,n,a.myStream)}if(o.update&&!a.streamExternal){if(o.removeAudio||o.replaceAudio){if(a.myStream&&a.myStream.getAudioTracks()&&a.myStream.getAudioTracks().length){var d=a.myStream.getAudioTracks()[0];u.log("Removing audio track:",d),a.myStream.removeTrack(d);try{d.stop()}catch(O){}}if(a.pc.getSenders()&&a.pc.getSenders().length){var c=!0;if(o.replaceAudio&&u.unifiedPlan&&(c=!1),c)for(var l in a.pc.getSenders()){d=a.pc.getSenders()[l];d&&d.track&&"audio"===d.track.kind&&(u.log("Removing audio sender:",d),a.pc.removeTrack(d))}}}if(o.removeVideo||o.replaceVideo){if(a.myStream&&a.myStream.getVideoTracks()&&a.myStream.getVideoTracks().length){d=a.myStream.getVideoTracks()[0];u.log("Removing video track:",d),a.myStream.removeTrack(d);try{d.stop()}catch(O){}}if(a.pc.getSenders()&&a.pc.getSenders().length){var v=!0;if(o.replaceVideo&&u.unifiedPlan&&(v=!1),v)for(var l in a.pc.getSenders()){d=a.pc.getSenders()[l];d&&d.track&&"video"===d.track.kind&&(u.log("Removing video sender:",d),a.pc.removeTrack(d))}}}}if(null!==n.stream&&void 0!==n.stream){var f=n.stream;if(u.log("MediaStream provided by the application"),u.debug(f),o.update&&a.myStream&&a.myStream!==n.stream&&!a.streamExternal){try{var g=a.myStream.getTracks();for(var p in g){var m=g[p];u.log(m),null!==m&&void 0!==m&&m.stop()}}catch(O){}a.myStream=null}return a.streamExternal=!0,i.consentDialog(!1),void N(e,t,o,n,f)}if(K(o)||ee(o)){if(!u.isGetUserMediaAvailable())return void n.error("getUserMedia not available");var b={mandatory:{},optional:[]};i.consentDialog(!0);var h=K(o);!0===h&&void 0!=o&&null!=o&&"object"===Object(s["a"])(o.audio)&&(h=o.audio);var S=ee(o);if(!0===S&&void 0!=o&&null!=o){var y=!0===n.simulcast,w=!0===n.simulcast2;if(!y&&!w||t||void 0!==o.video&&!1!==o.video||(o.video="hires"),o.video&&"screen"!=o.video&&"window"!=o.video)if("object"===Object(s["a"])(o.video))S=o.video;else{var T=0,C=0;"lowres"===o.video?(C=240,240,T=320):"lowres-16:9"===o.video?(C=180,180,T=320):"hires"===o.video||"hires-16:9"===o.video||"hdres"===o.video?(C=720,720,T=1280):"fhdres"===o.video?(C=1080,1080,T=1920):"4kres"===o.video?(C=2160,2160,T=3840):"stdres"===o.video?(C=480,480,T=640):"stdres-16:9"===o.video?(C=360,360,T=640):(u.log("Default video setting is stdres 4:3"),C=480,480,T=640),u.log("Adding media constraint:",o.video),S={height:{ideal:C},width:{ideal:T}},u.log("Adding video constraint:",S)}else if("screen"===o.video||"window"===o.video){var A=function(r,a){i.consentDialog(!1),r?n.error(r):N(e,t,o,n,a)},D=function(e,r,n){u.log("Adding media constraint (screen capture)"),u.debug(e),navigator.mediaDevices.getUserMedia(e).then(function(e){n?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(n){e.addTrack(n.getAudioTracks()[0]),r(null,e)}):r(null,e)}).catch(function(e){i.consentDialog(!1),r(e)})};if(o.screenshareFrameRate||(o.screenshareFrameRate=3),navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)return void navigator.mediaDevices.getDisplayMedia({video:!0}).then(function(r){i.consentDialog(!1),K(o)&&!o.keepAudio?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(i){r.addTrack(i.getAudioTracks()[0]),N(e,t,o,n,r)}):N(e,t,o,n,r)},function(e){i.consentDialog(!1),n.error(e)});if("chrome"===u.webRTCAdapter.browserDetails.browser){var R=u.webRTCAdapter.browserDetails.version,P=33;window.navigator.userAgent.match("Linux")&&(P=35),R>=26&&R<=P?(b={video:{mandatory:{googLeakyBucket:!0,maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:o.screenshareFrameRate,maxFrameRate:o.screenshareFrameRate,chromeMediaSource:"screen"}},audio:K(o)&&!o.keepAudio},D(b,A)):u.extension.getScreen(function(e,r){if(e)return i.consentDialog(!1),n.error(e);b={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:o.screenshareFrameRate,maxFrameRate:o.screenshareFrameRate},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}},b.video.mandatory.chromeMediaSourceId=r,D(b,A,K(o)&&!o.keepAudio)})}else if("firefox"===u.webRTCAdapter.browserDetails.browser){if(!(u.webRTCAdapter.browserDetails.version>=33)){var I=new Error("NavigatorUserMediaError");return I.name="Your version of Firefox does not support screen sharing, please install Firefox 33 (or more recent versions)",i.consentDialog(!1),void n.error(I)}b={video:{mozMediaSource:o.video,mediaSource:o.video},audio:K(o)&&!o.keepAudio},D(b,function(e,r){if(A(e,r),!e)var n=r.currentTime,t=window.setInterval(function(){r||window.clearInterval(t),r.currentTime==n&&(window.clearInterval(t),r.onended&&r.onended()),n=r.currentTime},500)})}return}}null!==o&&void 0!==o&&"screen"===o.video||navigator.mediaDevices.enumerateDevices().then(function(r){var a=r.some(function(e){return"audioinput"===e.kind}),s=te(o)||r.some(function(e){return"videoinput"===e.kind}),d=K(o),c=ee(o),l=X(o),v=re(o);if(d||c||l||v){var g=!!d&&a,p=!!c&&s;if(!g&&!p)return i.consentDialog(!1),n.error("No capture device found"),!1;if(!g&&l)return i.consentDialog(!1),n.error("Audio capture is required, but no capture device found"),!1;if(!p&&v)return i.consentDialog(!1),n.error("Video capture is required, but no capture device found"),!1}var m={audio:!(!a||o.keepAudio)&&h,video:!(!s||o.keepVideo)&&S};u.debug("getUserMedia constraints",m),m.audio||m.video?navigator.mediaDevices.getUserMedia(m).then(function(r){i.consentDialog(!1),N(e,t,o,n,r)}).catch(function(e){i.consentDialog(!1),n.error({code:e.code,name:e.name,message:e.message})}):(i.consentDialog(!1),N(e,t,o,n,f))}).catch(function(e){i.consentDialog(!1),n.error("enumerateDevices error",e)})}else N(e,t,o,n)}function F(e,r){r=r||{},r.success="function"==typeof r.success?r.success:u.noop,r.error="function"==typeof r.error?r.error:H;var n=r.jsep,t=k[e];if(null===t||void 0===t||null===t.webrtcStuff||void 0===t.webrtcStuff)return u.warn("Invalid handle"),void r.error("Invalid handle");var o=t.webrtcStuff;if(void 0!==n&&null!==n){if(null===o.pc)return u.warn("Wait, no PeerConnection?? if this is an answer, use createAnswer and not handleRemoteJsep"),void r.error("No PeerConnection: if this is an answer, use createAnswer and not handleRemoteJsep");o.pc.setRemoteDescription(n).then(function(){if(u.log("Remote description accepted!"),o.remoteSdp=n.sdp,o.candidates&&o.candidates.length>0){for(var e in o.candidates){var t=o.candidates[e];u.debug("Adding remote candidate:",t),t&&!0!==t.completed?o.pc.addIceCandidate(t):o.pc.addIceCandidate(u.endOfCandidates)}o.candidates=[]}r.success()},r.error)}else r.error("Invalid JSEP")}function J(e,r,n){n=n||{},n.success="function"==typeof n.success?n.success:u.noop,n.error="function"==typeof n.error?n.error:u.noop,n.customizeSdp="function"==typeof n.customizeSdp?n.customizeSdp:u.noop;var t=k[e];if(null===t||void 0===t||null===t.webrtcStuff||void 0===t.webrtcStuff)return u.warn("Invalid handle"),void n.error("Invalid handle");var o=t.webrtcStuff,i=!0===n.simulcast;i?u.log("Creating offer (iceDone="+o.iceDone+", simulcast="+i+")"):u.log("Creating offer (iceDone="+o.iceDone+")");var a={};if(u.unifiedPlan){var s=null,d=null,c=o.pc.getTransceivers();if(c&&c.length>0)for(var l in c){var v=c[l];v.sender&&v.sender.track&&"audio"===v.sender.track.kind||v.receiver&&v.receiver.track&&"audio"===v.receiver.track.kind?s||(s=v):(v.sender&&v.sender.track&&"video"===v.sender.track.kind||v.receiver&&v.receiver.track&&"video"===v.receiver.track.kind)&&(d||(d=v))}var f=K(r),g=Z(r);f||g?f&&g?s&&(s.setDirection?s.setDirection("sendrecv"):s.direction="sendrecv",u.log("Setting audio transceiver to sendrecv:",s)):f&&!g?s&&(s.setDirection?s.setDirection("sendonly"):s.direction="sendonly",u.log("Setting audio transceiver to sendonly:",s)):!f&&g&&(s?(s.setDirection?s.setDirection("recvonly"):s.direction="recvonly",u.log("Setting audio transceiver to recvonly:",s)):(s=o.pc.addTransceiver("audio",{direction:"recvonly"}),u.log("Adding recvonly audio transceiver:",s))):r.removeAudio&&s&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive",u.log("Setting audio transceiver to inactive:",s));var p=ee(r),m=ne(r);p||m?p&&m?d&&(d.setDirection?d.setDirection("sendrecv"):d.direction="sendrecv",u.log("Setting video transceiver to sendrecv:",d)):p&&!m?d&&(d.setDirection?d.setDirection("sendonly"):d.direction="sendonly",u.log("Setting video transceiver to sendonly:",d)):!p&&m&&(d?(d.setDirection?d.setDirection("recvonly"):d.direction="recvonly",u.log("Setting video transceiver to recvonly:",d)):(d=o.pc.addTransceiver("video",{direction:"recvonly"}),u.log("Adding recvonly video transceiver:",d))):r.removeVideo&&d&&(d.setDirection?d.setDirection("inactive"):d.direction="inactive",u.log("Setting video transceiver to inactive:",d))}else a["offerToReceiveAudio"]=Z(r),a["offerToReceiveVideo"]=ne(r);var b=!0===n.iceRestart;b&&(a["iceRestart"]=!0),u.debug(a);var h=ee(r);if(h&&i&&"firefox"===u.webRTCAdapter.browserDetails.browser){u.log("Enabling Simulcasting for Firefox (RID)");var S=o.pc.getSenders().find(function(e){return"video"==e.track.kind});if(S){var y=S.getParameters();y||(y={}),y.encodings=[{rid:"h",active:!0,maxBitrate:9e5},{rid:"m",active:!0,maxBitrate:3e5,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:1e5,scaleResolutionDownBy:4}],S.setParameters(y)}}o.pc.createOffer(a).then(function(e){u.debug(e);var r={type:e.type,sdp:e.sdp};n.customizeSdp(r),e.sdp=r.sdp,u.log("Setting local description"),h&&i&&("chrome"===u.webRTCAdapter.browserDetails.browser||"safari"===u.webRTCAdapter.browserDetails.browser?(u.log("Enabling Simulcasting for Chrome (SDP munging)"),e.sdp=Q(e.sdp)):"firefox"!==u.webRTCAdapter.browserDetails.browser&&u.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),o.mySdp=e.sdp,o.pc.setLocalDescription(e).catch(n.error),o.mediaConstraints=a,o.iceDone||o.trickle?(u.log("Offer ready"),u.debug(n),n.success(e)):u.log("Waiting for all candidates...")},n.error)}function q(e,r,n){n=n||{},n.success="function"==typeof n.success?n.success:u.noop,n.error="function"==typeof n.error?n.error:u.noop,n.customizeSdp="function"==typeof n.customizeSdp?n.customizeSdp:u.noop;var t=k[e];if(null===t||void 0===t||null===t.webrtcStuff||void 0===t.webrtcStuff)return u.warn("Invalid handle"),void n.error("Invalid handle");var o=t.webrtcStuff,i=!0===n.simulcast;i?u.log("Creating answer (iceDone="+o.iceDone+", simulcast="+i+")"):u.log("Creating answer (iceDone="+o.iceDone+")");var a=null;if(u.unifiedPlan){a={};var s=null,d=null,c=o.pc.getTransceivers();if(c&&c.length>0)for(var l in c){var v=c[l];v.sender&&v.sender.track&&"audio"===v.sender.track.kind||v.receiver&&v.receiver.track&&"audio"===v.receiver.track.kind?s||(s=v):(v.sender&&v.sender.track&&"video"===v.sender.track.kind||v.receiver&&v.receiver.track&&"video"===v.receiver.track.kind)&&(d||(d=v))}var f=K(r),g=Z(r);if(f||g){if(f&&g){if(s)try{s.setDirection?s.setDirection("sendrecv"):s.direction="sendrecv",u.log("Setting audio transceiver to sendrecv:",s)}catch(y){u.error(y)}}else if(f&&!g)try{s&&(s.setDirection?s.setDirection("sendonly"):s.direction="sendonly",u.log("Setting audio transceiver to sendonly:",s))}catch(y){u.error(y)}else if(!f&&g)if(s)try{s.setDirection?s.setDirection("recvonly"):s.direction="recvonly",u.log("Setting audio transceiver to recvonly:",s)}catch(y){u.error(y)}else s=o.pc.addTransceiver("audio",{direction:"recvonly"}),u.log("Adding recvonly audio transceiver:",s)}else if(r.removeAudio&&s)try{s.setDirection?s.setDirection("inactive"):s.direction="inactive",u.log("Setting audio transceiver to inactive:",s)}catch(y){u.error(y)}var p=ee(r),m=ne(r);if(p||m){if(p&&m){if(d)try{d.setDirection?d.setDirection("sendrecv"):d.direction="sendrecv",u.log("Setting video transceiver to sendrecv:",d)}catch(y){u.error(y)}}else if(p&&!m){if(d)try{d.setDirection?d.setDirection("sendonly"):d.direction="sendonly",u.log("Setting video transceiver to sendonly:",d)}catch(y){u.error(y)}}else if(!p&&m)if(d)try{d.setDirection?d.setDirection("recvonly"):d.direction="recvonly",u.log("Setting video transceiver to recvonly:",d)}catch(y){u.error(y)}else d=o.pc.addTransceiver("video",{direction:"recvonly"}),u.log("Adding recvonly video transceiver:",d)}else if(r.removeVideo&&d)try{d.setDirection?d.setDirection("inactive"):d.direction="inactive",u.log("Setting video transceiver to inactive:",d)}catch(y){u.error(y)}}else a="firefox"==u.webRTCAdapter.browserDetails.browser||"edge"==u.webRTCAdapter.browserDetails.browser?{offerToReceiveAudio:Z(r),offerToReceiveVideo:ne(r)}:{mandatory:{OfferToReceiveAudio:Z(r),OfferToReceiveVideo:ne(r)}};u.debug(a);var b=ee(r);if(b&&i&&"firefox"===u.webRTCAdapter.browserDetails.browser){u.log("Enabling Simulcasting for Firefox (RID)");var h=o.pc.getSenders()[1];u.log(h);var S=h.getParameters();u.log(S),h.setParameters({encodings:[{rid:"high",active:!0,priority:"high",maxBitrate:1e6},{rid:"medium",active:!0,priority:"medium",maxBitrate:3e5},{rid:"low",active:!0,priority:"low",maxBitrate:1e5}]})}o.pc.createAnswer(a).then(function(e){u.debug(e);var r={type:e.type,sdp:e.sdp};n.customizeSdp(r),e.sdp=r.sdp,u.log("Setting local description"),b&&i&&("chrome"===u.webRTCAdapter.browserDetails.browser?u.warn("simulcast=true, but this is an answer, and video breaks in Chrome if we enable it"):"firefox"!==u.webRTCAdapter.browserDetails.browser&&u.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),o.mySdp=e.sdp,o.pc.setLocalDescription(e).catch(n.error),o.mediaConstraints=a,o.iceDone||o.trickle?n.success(e):u.log("Waiting for all candidates...")},n.error)}function G(e,r){r=r||{},r.success="function"==typeof r.success?r.success:u.noop,r.error="function"==typeof r.error?r.error:u.noop;var n=k[e];if(null!==n&&void 0!==n&&null!==n.webrtcStuff&&void 0!==n.webrtcStuff){var t=n.webrtcStuff;u.log("Sending offer/answer SDP..."),null!==t.mySdp&&void 0!==t.mySdp?(t.mySdp={type:t.pc.localDescription.type,sdp:t.pc.localDescription.sdp},!1===t.trickle&&(t.mySdp["trickle"]=!1),u.debug(r),t.sdpSent=!0,r.success(t.mySdp)):u.warn("Local SDP instance is invalid, not sending anything...")}else u.warn("Invalid handle, not sending anything")}function W(e,r){var n=k[e];if(null===n||void 0===n||null===n.webrtcStuff||void 0===n.webrtcStuff)return u.warn("Invalid handle"),0;var t=r?"remote":"local",o=n.webrtcStuff;return o.volume[t]||(o.volume[t]={value:0}),o.pc.getStats&&"chrome"===u.webRTCAdapter.browserDetails.browser?!r||null!==o.remoteStream&&void 0!==o.remoteStream?r||null!==o.myStream&&void 0!==o.myStream?null===o.volume[t].timer||void 0===o.volume[t].timer?(u.log("Starting "+t+" volume monitor"),o.volume[t].timer=setInterval(function(){o.pc.getStats(function(e){for(var n=e.result(),i=0;i<n.length;i++){var a=n[i];"ssrc"==a.type&&(r&&a.stat("audioOutputLevel")?o.volume[t].value=parseInt(a.stat("audioOutputLevel")):!r&&a.stat("audioInputLevel")&&(o.volume[t].value=parseInt(a.stat("audioInputLevel"))))}})},200),0):o.volume[t].value:(u.warn("Local stream unavailable"),0):(u.warn("Remote stream unavailable"),0):(u.warn("Getting the "+t+" volume unsupported by browser"),0)}function $(e,r){var n=k[e];if(null===n||void 0===n||null===n.webrtcStuff||void 0===n.webrtcStuff)return u.warn("Invalid handle"),!0;var t=n.webrtcStuff;return null===t.pc||void 0===t.pc?(u.warn("Invalid PeerConnection"),!0):void 0===t.myStream||null===t.myStream?(u.warn("Invalid local MediaStream"),!0):r?null===t.myStream.getVideoTracks()||void 0===t.myStream.getVideoTracks()||0===t.myStream.getVideoTracks().length?(u.warn("No video track"),!0):!t.myStream.getVideoTracks()[0].enabled:null===t.myStream.getAudioTracks()||void 0===t.myStream.getAudioTracks()||0===t.myStream.getAudioTracks().length?(u.warn("No audio track"),!0):!t.myStream.getAudioTracks()[0].enabled}function B(e,r,n){var t=k[e];if(null===t||void 0===t||null===t.webrtcStuff||void 0===t.webrtcStuff)return u.warn("Invalid handle"),!1;var o=t.webrtcStuff;return null===o.pc||void 0===o.pc?(u.warn("Invalid PeerConnection"),!1):void 0===o.myStream||null===o.myStream?(u.warn("Invalid local MediaStream"),!1):r?null===o.myStream.getVideoTracks()||void 0===o.myStream.getVideoTracks()||0===o.myStream.getVideoTracks().length?(u.warn("No video track"),!1):(o.myStream.getVideoTracks()[0].enabled=!n,!0):null===o.myStream.getAudioTracks()||void 0===o.myStream.getAudioTracks()||0===o.myStream.getAudioTracks().length?(u.warn("No audio track"),!1):(o.myStream.getAudioTracks()[0].enabled=!n,!0)}function z(e){var r=k[e];if(null===r||void 0===r||null===r.webrtcStuff||void 0===r.webrtcStuff)return u.warn("Invalid handle"),"Invalid handle";var n=r.webrtcStuff;return null===n.pc||void 0===n.pc?"Invalid PeerConnection":n.pc.getStats?null===n.bitrate.timer||void 0===n.bitrate.timer?(u.log("Starting bitrate timer (via getStats)"),n.bitrate.timer=setInterval(function(){n.pc.getStats().then(function(e){e.forEach(function(e){if(e){var r=!1;if(("video"===e.mediaType||e.id.toLowerCase().indexOf("video")>-1)&&"inbound-rtp"===e.type&&e.id.indexOf("rtcp")<0?r=!0:"ssrc"!=e.type||!e.bytesReceived||"VP8"!==e.googCodecName&&""!==e.googCodecName||(r=!0),r)if(n.bitrate.bsnow=e.bytesReceived,n.bitrate.tsnow=e.timestamp,null===n.bitrate.bsbefore||null===n.bitrate.tsbefore)n.bitrate.bsbefore=n.bitrate.bsnow,n.bitrate.tsbefore=n.bitrate.tsnow;else{var t=n.bitrate.tsnow-n.bitrate.tsbefore;"safari"==u.webRTCAdapter.browserDetails.browser&&(t/=1e3);var o=Math.round(8*(n.bitrate.bsnow-n.bitrate.bsbefore)/t);"safari"===u.webRTCAdapter.browserDetails.browser&&(o=parseInt(o/1e3)),n.bitrate.value=o+" kbits/sec",n.bitrate.bsbefore=n.bitrate.bsnow,n.bitrate.tsbefore=n.bitrate.tsnow}}})})},1e3),"0 kbits/sec"):n.bitrate.value:(u.warn("Getting the video bitrate unsupported by browser"),"Feature unsupported by browser")}function H(e){u.error("WebRTC error:",e)}function Y(e,t){u.log("Cleaning WebRTC stuff");var o=k[e];if(null!==o&&void 0!==o){var i=o.webrtcStuff;if(null!==i&&void 0!==i){if(!0===t){var a={janus:"hangup",transaction:u.randomString(12)};null!==o.token&&void 0!==o.token&&(a["token"]=o.token),null!==b&&void 0!==b&&(a["apisecret"]=b),u.debug("Sending hangup request (handle="+e+"):"),u.debug(a),r?(a["session_id"]=w,a["handle_id"]=e,n.send(JSON.stringify(a))):u.httpAPICall(d+"/"+w+"/"+e,{verb:"POST",withCredentials:g,body:a})}i.remoteStream=null,i.volume&&(i.volume["local"]&&i.volume["local"].timer&&clearInterval(i.volume["local"].timer),i.volume["remote"]&&i.volume["remote"].timer&&clearInterval(i.volume["remote"].timer)),i.volume={},i.bitrate.timer&&clearInterval(i.bitrate.timer),i.bitrate.timer=null,i.bitrate.bsnow=null,i.bitrate.bsbefore=null,i.bitrate.tsnow=null,i.bitrate.tsbefore=null,i.bitrate.value=null;try{if(!i.streamExternal&&null!==i.myStream&&void 0!==i.myStream){u.log("Stopping local stream tracks");var s=i.myStream.getTracks();for(var c in s){var l=s[c];u.log(l),null!==l&&void 0!==l&&l.stop()}}}catch(v){}i.streamExternal=!1,i.myStream=null;try{i.pc.close()}catch(v){}i.pc=null,i.candidates=null,i.mySdp=null,i.remoteSdp=null,i.iceDone=!1,i.dataChannel={},i.dtmfSender=null}o.oncleanup()}}function Q(e){for(var r=e.split("\r\n"),n=!1,t=[-1],o=[-1],i=null,a=null,s=null,d=null,c=-1,l=0;l<r.length;l++){var v=r[l].match(/m=(\w+) */);if(v){var f=v[1];if("video"===f){if(!(t[0]<0)){c=l;break}n=!0}else if(t[0]>-1){c=l;break}}else if(n){var g=r[l].match(/a=ssrc-group:FID (\d+) (\d+)/);if(g)t[0]=g[1],o[0]=g[2],r.splice(l,1),l--;else{if(t[0]){var p=r[l].match("a=ssrc:"+t[0]+" cname:(.+)");if(p&&(i=p[1]),p=r[l].match("a=ssrc:"+t[0]+" msid:(.+)"),p&&(a=p[1]),p=r[l].match("a=ssrc:"+t[0]+" mslabel:(.+)"),p&&(s=p[1]),p=r[l].match("a=ssrc:"+t[0]+" label:(.+)"),p&&(d=p[1]),0===r[l].indexOf("a=ssrc:"+o[0])){r.splice(l,1),l--;continue}if(0===r[l].indexOf("a=ssrc:"+t[0])){r.splice(l,1),l--;continue}}0!=r[l].length||(r.splice(l,1),l--)}}}if(t[0]<0){c=-1,n=!1;for(l=0;l<r.length;l++){v=r[l].match(/m=(\w+) */);if(v){f=v[1];if("video"===f){if(!(t[0]<0)){c=l;break}n=!0}else if(t[0]>-1){c=l;break}}else if(n){if(t[0]<0){var m=r[l].match(/a=ssrc:(\d+)/);if(m){t[0]=m[1],r.splice(l,1),l--;continue}}else{p=r[l].match("a=ssrc:"+t[0]+" cname:(.+)");if(p&&(i=p[1]),p=r[l].match("a=ssrc:"+t[0]+" msid:(.+)"),p&&(a=p[1]),p=r[l].match("a=ssrc:"+t[0]+" mslabel:(.+)"),p&&(s=p[1]),p=r[l].match("a=ssrc:"+t[0]+" label:(.+)"),p&&(d=p[1]),0===r[l].indexOf("a=ssrc:"+o[0])){r.splice(l,1),l--;continue}if(0===r[l].indexOf("a=ssrc:"+t[0])){r.splice(l,1),l--;continue}}0!=r[l].length||(r.splice(l,1),l--)}}}if(t[0]<0)return u.warn("Couldn't find the video SSRC, simulcasting NOT enabled"),e;c<0&&(c=r.length),t[1]=Math.floor(4294967295*Math.random()),t[2]=Math.floor(4294967295*Math.random()),o[1]=Math.floor(4294967295*Math.random()),o[2]=Math.floor(4294967295*Math.random());for(l=0;l<t.length;l++)i&&(r.splice(c,0,"a=ssrc:"+t[l]+" cname:"+i),c++),a&&(r.splice(c,0,"a=ssrc:"+t[l]+" msid:"+a),c++),s&&(r.splice(c,0,"a=ssrc:"+t[l]+" mslabel:"+s),c++),d&&(r.splice(c,0,"a=ssrc:"+t[l]+" label:"+d),c++),i&&(r.splice(c,0,"a=ssrc:"+o[l]+" cname:"+i),c++),a&&(r.splice(c,0,"a=ssrc:"+o[l]+" msid:"+a),c++),s&&(r.splice(c,0,"a=ssrc:"+o[l]+" mslabel:"+s),c++),d&&(r.splice(c,0,"a=ssrc:"+o[l]+" label:"+d),c++);return r.splice(c,0,"a=ssrc-group:FID "+t[2]+" "+o[2]),r.splice(c,0,"a=ssrc-group:FID "+t[1]+" "+o[1]),r.splice(c,0,"a=ssrc-group:FID "+t[0]+" "+o[0]),r.splice(c,0,"a=ssrc-group:SIM "+t[0]+" "+t[1]+" "+t[2]),e=r.join("\r\n"),e.endsWith("\r\n")||(e+="\r\n"),e}function K(e){return u.debug("isAudioSendEnabled:",e),void 0===e||null===e||!1!==e.audio&&(void 0===e.audioSend||null===e.audioSend||!0===e.audioSend)}function X(e){return u.debug("isAudioSendRequired:",e),void 0!==e&&null!==e&&(!1!==e.audio&&!1!==e.audioSend&&(void 0!==e.failIfNoAudio&&null!==e.failIfNoAudio&&!0===e.failIfNoAudio))}function Z(e){return u.debug("isAudioRecvEnabled:",e),void 0===e||null===e||!1!==e.audio&&(void 0===e.audioRecv||null===e.audioRecv||!0===e.audioRecv)}function ee(e){return u.debug("isVideoSendEnabled:",e),void 0===e||null===e||!1!==e.video&&(void 0===e.videoSend||null===e.videoSend||!0===e.videoSend)}function re(e){return u.debug("isVideoSendRequired:",e),void 0!==e&&null!==e&&(!1!==e.video&&!1!==e.videoSend&&(void 0!==e.failIfNoVideo&&null!==e.failIfNoVideo&&!0===e.failIfNoVideo))}function ne(e){return u.debug("isVideoRecvEnabled:",e),void 0===e||null===e||!1!==e.video&&(void 0===e.videoRecv||null===e.videoRecv||!0===e.videoRecv)}function te(e){if(u.debug("isScreenSendEnabled:",e),void 0===e||null===e)return!1;if("object"!==Object(s["a"])(e.video)||"object"!==Object(s["a"])(e.video.mandatory))return!1;var r=e.video.mandatory;return r.chromeMediaSource?"desktop"===r.chromeMediaSource||"screen"===r.chromeMediaSource:r.mozMediaSource?"window"===r.mozMediaSource||"screen"===r.mozMediaSource:!!r.mediaSource&&("window"===r.mediaSource||"screen"===r.mediaSource)}function oe(e){return u.debug("isDataEnabled:",e),"edge"==u.webRTCAdapter.browserDetails.browser?(u.warn("Edge doesn't support data channels yet"),!1):void 0!==e&&null!==e&&!0===e.data}function ie(e){return u.debug("isTrickleEnabled:",e),void 0===e||null===e||!0===e}I(e),this.getServer=function(){return d},this.isConnected=function(){return y},this.reconnect=function(e){e=e||{},e.success="function"==typeof e.success?e.success:u.noop,e.error="function"==typeof e.error?e.error:u.noop,e["reconnect"]=!0,I(e)},this.getSessionId=function(){return w},this.destroy=function(e){O(e)},this.attach=function(e){V(e)}}u.useDefaultDependencies=function(e){var r=e&&e.fetch||fetch,n=e&&e.Promise||Promise,t=e&&e.WebSocket||WebSocket;return{newWebSocket:function(e,r){return new t(e,r)},extension:e&&e.extension||l,isArray:function(e){return Array.isArray(e)},webRTCAdapter:e&&e.adapter||c.a,httpAPICall:function(e,t){var o={method:t.verb,headers:{Accept:"application/json, text/plain, */*"},cache:"no-cache"};"POST"===t.verb&&(o.headers["Content-Type"]="application/json"),void 0!==t.withCredentials&&(o.credentials=!0===t.withCredentials?"include":t.withCredentials?t.withCredentials:"omit"),void 0!==t.body&&(o.body=JSON.stringify(t.body));var i=r(e,o).catch(function(e){return n.reject({message:"Probably a network error, is the server down?",error:e})});if(void 0!==t.timeout){var a=new n(function(e,r){var n=setTimeout(function(){return clearTimeout(n),r({message:"Request timed out",timeout:t.timeout})},t.timeout)});i=n.race([i,a])}return i.then(function(e){return e.ok?Object(s["a"])(t.success)===Object(s["a"])(u.noop)?e.json().then(function(e){t.success(e)}).catch(function(r){return n.reject({message:"Failed to parse response body",error:r,response:e})}):void 0:n.reject({message:"API call failed",response:e})}).catch(function(e){Object(s["a"])(t.error)===Object(s["a"])(u.noop)&&t.error(e.message||"<< internal error >>",e)}),i}}},u.useOldDependencies=function(e){var r=e&&e.jQuery||jQuery,n=e&&e.WebSocket||WebSocket;return{newWebSocket:function(e,r){return new n(e,r)},isArray:function(e){return r.isArray(e)},extension:e&&e.extension||l,webRTCAdapter:e&&e.adapter||c.a,httpAPICall:function(e,n){var t=void 0!==n.body?{contentType:"application/json",data:JSON.stringify(n.body)}:{},o=void 0!==n.withCredentials?{xhrFields:{withCredentials:n.withCredentials}}:{};return r.ajax(r.extend(t,o,{url:e,type:n.verb,cache:!1,dataType:"json",async:n.async,timeout:n.timeout,success:function(e){Object(s["a"])(n.success)===Object(s["a"])(u.noop)&&n.success(e)},error:function(e,r,t){Object(s["a"])(n.error)===Object(s["a"])(u.noop)&&n.error(r,t)}}))}}},u.noop=function(){},u.dataChanDefaultLabel="JanusDataChannel",u.endOfCandidates=null,u.init=function(e){if(e=e||{},e.callback="function"==typeof e.callback?e.callback:u.noop,!0===u.initDone)e.callback();else{if("undefined"!=typeof console&&"undefined"!=typeof console.log||(console={log:function(){}}),u.trace=u.noop,u.debug=u.noop,u.vdebug=u.noop,u.log=u.noop,u.warn=u.noop,u.error=u.noop,!0===e.debug||"all"===e.debug)u.trace=console.trace.bind(console),u.debug=console.debug.bind(console),u.vdebug=console.debug.bind(console),u.log=console.log.bind(console),u.warn=console.warn.bind(console),u.error=console.error.bind(console);else if(Array.isArray(e.debug))for(var r in e.debug){var n=e.debug[r];switch(n){case"trace":u.trace=console.trace.bind(console);break;case"debug":u.debug=console.debug.bind(console);break;case"vdebug":u.vdebug=console.debug.bind(console);break;case"log":u.log=console.log.bind(console);break;case"warn":u.warn=console.warn.bind(console);break;case"error":u.error=console.error.bind(console);break;default:console.error("Unknown debugging option '"+n+"' (supported: 'trace', 'debug', 'vdebug', 'log', warn', 'error')");break}}u.log("Initializing library");var t=e.dependencies||u.useDefaultDependencies();u.isArray=t.isArray,u.webRTCAdapter=t.webRTCAdapter,u.httpAPICall=t.httpAPICall,u.newWebSocket=t.newWebSocket,u.extension=t.extension,u.extension.init(),u.listDevices=function(e,r){e="function"==typeof e?e:u.noop,null==r&&(r={audio:!0,video:!0}),u.isGetUserMediaAvailable()?navigator.mediaDevices.getUserMedia(r).then(function(r){navigator.mediaDevices.enumerateDevices().then(function(n){u.debug(n),e(n);try{var t=r.getTracks();for(var o in t){var i=t[o];null!==i&&void 0!==i&&i.stop()}}catch(a){}})}).catch(function(r){u.error(r),e([])}):(u.warn("navigator.mediaDevices unavailable"),e([]))},u.attachMediaStream=function(e,r){if("chrome"===u.webRTCAdapter.browserDetails.browser){var n=u.webRTCAdapter.browserDetails.version;n>=52?e.srcObject=r:"undefined"!==typeof e.src?e.src=URL.createObjectURL(r):u.error("Error attaching stream to element")}else e.srcObject=r},u.reattachMediaStream=function(e,r){if("chrome"===u.webRTCAdapter.browserDetails.browser){var n=u.webRTCAdapter.browserDetails.version;n>=52?e.srcObject=r.srcObject:"undefined"!==typeof e.src?e.src=r.src:u.error("Error reattaching stream to element")}else e.srcObject=r.srcObject};var o=["iPad","iPhone","iPod"].indexOf(navigator.platform)>=0,i=o?"pagehide":"beforeunload",a=window["on"+i];if(window.addEventListener(i,function(e){for(var r in u.log("Closing window"),u.sessions)null!==u.sessions[r]&&void 0!==u.sessions[r]&&u.sessions[r].destroyOnUnload&&(u.log("Destroying session "+r),u.sessions[r].destroy({asyncRequest:!1,notifyDestroyed:!1}));a&&"function"==typeof a&&a()}),u.safariVp8=!1,"safari"===u.webRTCAdapter.browserDetails.browser&&u.webRTCAdapter.browserDetails.version>=605)if(RTCRtpSender&&RTCRtpSender.getCapabilities&&RTCRtpSender.getCapabilities("video")&&RTCRtpSender.getCapabilities("video").codecs&&RTCRtpSender.getCapabilities("video").codecs.length){for(var r in RTCRtpSender.getCapabilities("video").codecs){var s=RTCRtpSender.getCapabilities("video").codecs[r];if(s&&s.mimeType&&"video/vp8"===s.mimeType.toLowerCase()){u.safariVp8=!0;break}}u.safariVp8?u.log("This version of Safari supports VP8"):u.warn("This version of Safari does NOT support VP8: if you're using a Technology Preview, try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu")}else{var d=new RTCPeerConnection({},{});d.createOffer({offerToReceiveVideo:!0}).then(function(e){u.safariVp8=-1!==e.sdp.indexOf("VP8"),u.safariVp8?u.log("This version of Safari supports VP8"):u.warn("This version of Safari does NOT support VP8: if you're using a Technology Preview, try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu"),d.close(),d=null})}if(u.unifiedPlan=!1,"firefox"===u.webRTCAdapter.browserDetails.browser&&u.webRTCAdapter.browserDetails.version>=59)u.unifiedPlan=!0;else if("chrome"===u.webRTCAdapter.browserDetails.browser&&u.webRTCAdapter.browserDetails.version<72)u.unifiedPlan=!1;else if("currentDirection"in RTCRtpTransceiver.prototype){var c=new RTCPeerConnection;try{c.addTransceiver("audio"),u.unifiedPlan=!0}catch(l){}c.close()}else u.unifiedPlan=!1;u.initDone=!0,e.callback()}},u.isWebrtcSupported=function(){return void 0!==window.RTCPeerConnection&&null!==window.RTCPeerConnection},u.isGetUserMediaAvailable=function(){return void 0!==navigator.mediaDevices&&null!==navigator.mediaDevices&&void 0!==navigator.mediaDevices.getUserMedia&&null!==navigator.mediaDevices.getUserMedia},u.randomString=function(e){for(var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",t=0;t<e;t++){var o=Math.floor(Math.random()*r.length);n+=r.substring(o,o+1)}return n};var v={props:{rtspSrc:{type:String,default:"rtsp://camproxy.ru:8554/bars"}},name:"appPlayer",components:{},data:function(){return{isLoading:!1,janusServerUrl:"camproxy.ru",player:null,videoStyle:{height:0},paused:!1,streaming:null,janus:null,ports:{http:{socket:{url:"wss://%s:8989"},http:{url:"http://%s:8088/janus"}},https:{socket:{url:"wss://%s:8989"},https:{url:"https://%s:8089/janus"}}}}},watch:{},created:function(){window.player=this.player},computed:{client:function(){return this.player.client},isStoped:function(){return this.playerEl.client.paused},playerEl:function(){return this.$refs.rtspPlayer},rtspHost:function(){return window.location.protocol.replace(":","")},isSupportWebsocket:function(){return!!window.WebSocket},rtspServerUrl:function(){var e=this.ports[this.rtspHost][this.isSupportWebsocket?"socket":this.rtspHost].url;return e.replace("%s",this.janusServerUrl)},isPlaying:{get:function(){return this.$store.state.isPlaying},set:function(e){this.$store.commit("SET_PLAYING_STATE",e)}},console:{get:function(){return this.$store.state.logs},set:function(e){this.$store.commit("SET_LOG",e)}}},mounted:function(){this.player=!1,this.$nextTick(function(){this.load()})},methods:{load:function(){var e=this,r="streamingtest-"+u.randomString(12);u.init({debug:"all",callback:function(){e.janus=new u({server:e.rtspServerUrl,success:function(){e.janus.attach({plugin:"janus.plugin.gstreamer",opaqueId:r,success:function(r){e.streaming=r,e.log("Plugin attached! ("+e.streaming.getPlugin()+", id="+e.streaming.getId()+")")},error:function(r){e.error("-- Error attaching plugin...:","error")},onmessage:function(r,n){e.debug(" ::: Got a message :::"),e.debug(r);var t=r["result"];if(null!==t&&void 0!==t){if(void 0!==t["status"]&&null!==t["status"]){var o=t["status"];"stopped"===o&&e.stopStream()}}else if(void 0!==r["error"]&&null!==r["error"])return e.error(r["error"]),void e.stopStream();void 0!==n&&null!==n&&(e.debug("Handling SDP as well..."),e.debug(n),e.streaming.createAnswer({jsep:n,media:{audioSend:!1,videoSend:!1},success:function(r){e.debug("Got SDP!"),e.debug(r);var n={request:"start"};e.streaming.send({message:n,jsep:r}),e.startStream()},error:function(r){e.error("WebRTC error:")}}))},onremotestream:function(r){e.debug(" ::: Got a remote stream :::"),e.debug(r),u.attachMediaStream(e.playerEl,r)},oncleanup:function(){e.log(" ::: Got a cleanup notification :::")}})},error:function(r){e.error("Error:",r)}})}})},startStream:function(){if(void 0!==this.rtspSrc&&null!==this.rtspSrc&&this.rtspSrc){this.isPlaying=!0;var e={request:"watch",mrl:this.rtspSrc};this.streaming.send({message:e}),this.$store.commit("SET_RTSP_SERVER_LIST",this.rtspSrc),this.setVideoStyle()}else this.error("Enter source MRL")},stopStream:function(){this.isPlaying=!1,this.streaming.send({message:{request:"stop"}}),this.streaming.hangup()},destroyed:function(){window.location.reload()},error:function(e){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];u.error(e,r),this.console={message:"".concat(e,"... ").concat(r?JSON.stringify(r):""),type:"error"},this.$buefy.dialog.alert({title:"Error",message:"".concat(e,"... ").concat(r?JSON.stringify(r):""),type:"is-danger",hasIcon:!0,icon:"times-circle",iconPack:"fa"})},log:function(e){u.log(e),this.console={message:"Janus.log: ".concat(e),type:"debug"}},debug:function(e){u.debug(e),this.console={message:e,type:"debug"}}}},f=v,g=n("2877"),p=Object(g["a"])(f,i,a,!1,null,null,null),m=p.exports,b={name:"app",components:{player:m},data:function(){return{appConsole:[],showLogs:!1,rtspSrc:"",logTabsActive:0,logsTypeClasses:{debug:"dark",error:"danger",info:"info"},selected:null}},watch:{console:function(){this.$refs.consolePanel.scrollTop=this.$refs.consolePanel.scrollHeight}},computed:{isPlaying:{get:function(){return this.$store.state.isPlaying},set:function(e){this.$store.commit("SET_PLAYING_STATE",e)}},serverList:{get:function(){return this.$store.state.RTSPServerList},set:function(e){this.$store.commit("SET_RTSP_SERVER_LIST",e)}},console:{get:function(){return this.$store.state.logs},set:function(e){this.$store.commit("SET_LOG",e)}}},mounted:function(){this.$route.query.clear&&this.$store.commit("CLEAR_RTSP_SERVER_LIST"),!this.serverList.length||this.$store.state.activeRTSPUrl||this.rtspSrc||(this.$store.state.activeRTSPUrl=this.serverList[0],this.rtspSrc=this.serverList[0])},methods:{}},h=b,S=(n("5c0b"),Object(g["a"])(h,t,o,!1,null,null,null));r["default"]=S.exports},"56d7":function(e,r,n){"use strict";n.r(r);n("cadf"),n("551c"),n("f751"),n("097d");var t=n("2b0e"),o=n("3dfd"),i=n("289d"),a=n("d093"),s=(n("6762"),n("2fdb"),n("2f62")),d=n("bfa9");t["a"].use(s["a"]);var c=new d["a"]({storage:window.localStorage,reducer:function(e){return{RTSPServerList:e.RTSPServerList}}}),l=new s["a"].Store({state:{isPlaying:!1,logs:{info:[],error:[],debug:[]},activeRTSPUrl:"",RTSPServerList:[]},getters:{logs:function(e){return e.logs},RTSPServerList:function(e){return e.RTSPServerList}},mutations:{SET_LOG:function(e,r){e.logs[r.type].push({message:r.message,type:r.type})},SET_PLAYING_STATE:function(e,r){e.isPlaying=r},SET_RTSP_SERVER_LIST:function(e,r){e.activeRTSPUrl=r,e.RTSPServerList.includes(r)||e.RTSPServerList.push(r)},CLEAR_RTSP_SERVER_LIST:function(e){e.RTSPServerList=[]},CLEAR_LOGS:function(e){e.logs=[]}},actions:{},plugins:[c.plugin]}),u=(n("5abe"),n("8c4f"));t["a"].use(u["a"]);var v=new u["a"]({mode:"history",base:"/janus-vue-demo/",routes:[{path:"/",name:"home",component:function(){return Promise.resolve().then(n.bind(null,"3dfd"))}}]});t["a"].use(a["a"]),t["a"].use(i["a"]),t["a"].config.productionTip=!1,new t["a"]({store:l,router:v,render:function(e){return e(o["default"])}}).$mount("#app")},"5c0b":function(e,r,n){"use strict";var t=n("5e27"),o=n.n(t);o.a},"5e27":function(e,r,n){}});
//# sourceMappingURL=app.5daee98b.js.map